<!DOCTYPE html>
<html>
<head>
    <title>Easypanel OAuth2 Server</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .auth-status {
            text-align: right;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        h2 {
            color: #3498db;
            margin: 30px 0 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        h3 {
            color: #2c3e50;
            margin: 25px 0 10px;
        }

        a {
            color: #3498db;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .btn {
            display: inline-block;
            background-color: #3498db;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            text-decoration: none;
            margin-top: 10px;
        }

        .btn:hover {
            background-color: #2980b9;
            text-decoration: none;
        }

        .endpoints {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .endpoint-card {
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 15px;
            transition: all 0.2s ease;
        }

        .endpoint-card:hover {
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .endpoint-path {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 5px 8px;
            border-radius: 3px;
            font-size: 14px;
            margin-right: 8px;
        }

        .endpoint-method {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 8px;
        }

        .method-get {
            background-color: #61affe;
            color: white;
        }

        .method-post {
            background-color: #49cc90;
            color: white;
        }

        .flow-diagram {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f5f5f5;
        }

        .intro {
            background-color: #f5f7fa;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 30px;
        }

        code {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 90%;
        }

        @media (max-width: 768px) {
            .endpoints {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<header>
    <div>
        <h1>Easypanel OAuth2 Server</h1>
        <p>A standards-compliant OAuth2 authorization server with Easypanel integration</p>
    </div>

    <div class="auth-status">
        <% if (user) { %>
            <p>Logged in as: <strong><%= user.email %></strong></p>
            <a href="/logout" class="btn">Logout</a>
        <% } else { %>
            <a href="/login" class="btn">Login</a>
        <% } %>
    </div>
</header>

<div class="intro">
    <h2>Overview</h2>
    <p>
        This OAuth2 server integrates with the Easypanel user authentication system, allowing third-party applications to
        securely authenticate and access resources on behalf of Easypanel users without exposing their credentials.
    </p>
    <p>
        The server implements standard OAuth2 grant types including Authorization Code Flow, Refresh Token Flow,
        and Device Authorization Flow, following OAuth2.0 and OpenID Connect specifications.
    </p>
</div>

<h2>Available Endpoints</h2>

<div class="endpoints">
    <div class="endpoint-card">
        <span class="endpoint-method method-get">GET</span>
        <span class="endpoint-path">/.well-known/openid-configuration</span>
        <h3>Discovery Endpoint</h3>
        <p>Provides metadata about the OAuth2 server, allowing clients to programmatically discover endpoints and capabilities.</p>
    </div>

    <div class="endpoint-card">
        <span class="endpoint-method method-get">GET</span>
        <span class="endpoint-path">/oauth/authorize</span>
        <h3>Authorization Endpoint</h3>
        <p>Initiates the authorization flow where users authenticate and grant permission for client applications.</p>
    </div>

    <div class="endpoint-card">
        <span class="endpoint-method method-post">POST</span>
        <span class="endpoint-path">/oauth/token</span>
        <h3>Token Endpoint</h3>
        <p>Exchanges authorization codes for access tokens and refresh tokens. Also handles refresh token flows.</p>
    </div>

    <div class="endpoint-card">
        <span class="endpoint-method method-post">POST</span>
        <span class="endpoint-path">/oauth/introspect</span>
        <h3>Token Introspection</h3>
        <p>Allows resource servers to validate tokens and retrieve token metadata.</p>
    </div>

    <div class="endpoint-card">
        <span class="endpoint-method method-get">GET</span>
        <span class="endpoint-path">/oauth/userinfo</span>
        <h3>UserInfo Endpoint</h3>
        <p>Returns claims about the authenticated user based on the scopes granted to the client.</p>
    </div>

    <div class="endpoint-card">
        <span class="endpoint-method method-get">GET</span>
        <span class="endpoint-path">/oauth/jwks</span>
        <h3>JWKS Endpoint</h3>
        <p>Provides the public keys needed to verify the signature of JWT tokens issued by this server.</p>
    </div>

    <div class="endpoint-card">
        <span class="endpoint-method method-post">POST</span>
        <span class="endpoint-path">/oauth/revoke</span>
        <h3>Token Revocation</h3>
        <p>Allows clients to invalidate access or refresh tokens when they're no longer needed.</p>
    </div>

    <div class="endpoint-card">
        <span class="endpoint-method method-post">POST</span>
        <span class="endpoint-path">/oauth/device</span>
        <h3>Device Authorization</h3>
        <p>Initiates the device authorization flow for devices with limited input capabilities.</p>
    </div>
</div>

<h2>OAuth2 Flows</h2>

<h3>Authorization Code Flow</h3>
<div class="flow-diagram">
    <pre>
+--------+                                           +---------------+
|        |--(1)- Authorization Request ------------->|               |
|        |                                           |   Resource    |
|        |<-(2)-- Authorization Code ----------------|    Owner     |
|        |                                           |               |
|        |                                           +---------------+
|        |
|        |                                           +---------------+
|        |--(3)-- Authorization Code -------------->|               |
| Client |                                           | Authorization |
|        |<-(4)-- Access Token ----------------------|    Server     |
|        |        & Refresh Token                    |               |
|        |                                           +---------------+
|        |
|        |                                           +---------------+
|        |--(5)-- Access Token -------------------->|               |
|        |                                           |   Resource    |
|        |<-(6)-- Protected Resource ----------------|    Server     |
+--------+                                           +---------------+
    </pre>
</div>

<h3>Device Authorization Flow</h3>
<div class="flow-diagram">
    <pre>
+--------+                                +---------------+
|        |--(1)-- Device Authorization Request --------->|               |
|        |                                               | Authorization |
|        |<-(2)-- Device Code,                          |     Server    |
|        |         User Code,                           |               |
|        |         & Verification URI                   +---------------+
|        |
| Client |                                +---------------+
|        |                                |               |
|        |                                |     User      |
|        |<-(3)-- Complete Authorization -|    (Browser)  |
|        |                                |               |
|        |                                +---------------+
|        |
|        |                                +---------------+
|        |--(4)-- Device Code -------------------------->|               |
|        |         & Polling                             | Authorization |
|        |<-(5)-- Access Token --------------------------->|     Server    |
+--------+         & Refresh Token                      +---------------+
    </pre>
</div>

<h2>Scopes</h2>

<table>
    <thead>
    <tr>
        <th>Scope</th>
        <th>Description</th>
    </tr>
    </thead>
    <tbody>
    <tr>
        <td><code>profile</code></td>
        <td>Access to the user's basic profile information</td>
    </tr>
    <tr>
        <td><code>email</code></td>
        <td>Access to the user's email address</td>
    </tr>
    <tr>
        <td><code>openid</code></td>
        <td>OpenID Connect compliance indication</td>
    </tr>
    </tbody>
</table>

<h2>Client Management</h2>

<% if (user && user.admin) { %>
    <p>As an administrator, you can manage OAuth clients through the API:</p>
    <ul>
        <li><code>GET /api/clients</code> - List all clients</li>
        <li><code>GET /api/clients/:id</code> - Get a specific client</li>
        <li><code>POST /api/clients</code> - Create a new client</li>
        <li><code>PUT /api/clients/:id</code> - Update a client</li>
        <li><code>DELETE /api/clients/:id</code> - Delete a client</li>
    </ul>
    <a href="/api/clients" class="btn">Manage Clients</a>
<% } else { %>
    <p>Client management is available to administrators only.</p>
<% } %>

<footer style="margin-top: 50px; padding-top: 20px; border-top: 1px solid #eee; text-align: center;">
    <p>Easypanel OAuth2 Server &copy; <%= new Date().getFullYear() %></p>
</footer>
</body>
</html>